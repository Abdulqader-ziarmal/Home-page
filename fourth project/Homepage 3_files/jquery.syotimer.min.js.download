!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,i){return void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(i),i}:e(t)}((function(e){var t="day",i="hour",n="minute",o="second",r={d:t,h:i,m:n,s:o},a={list:[o,n,i,t],next:function(e){var t=this.list.indexOf(e);return t<this.list.length&&this.list[t+1]},prev:function(e){var t=this.list.indexOf(e);return 0<t&&this.list[t-1]}},s={year:2034,month:7,day:31,hour:0,minute:0,second:0,timeZone:"local",ignoreTransferTime:!1,layout:"dhms",periodic:!1,periodInterval:7,periodUnit:"d",doubleNumbers:!0,effectType:"none",lang:"eng",headTitle:"",footTitle:"",afterDeadline:function(e){e.bodyBlock.html('<p style="font-size: 1.2em;">The countdown is finished!</p>')}},d={second:!1,minute:!1,hour:!1,day:!1},u={init:function(t){var i=e.extend({},s,t||{});i.itemTypes=l.getItemTypesByLayout(i.layout),i._itemsHas=e.extend({},d);for(var n=0;n<i.itemTypes.length;n++)i._itemsHas[i.itemTypes[n]]=!0;return this.each((function(){e(this).data("syotimer-options",i),u._render.apply(this,[]),u._perSecondHandler.apply(this,[])}))},_render:function(){for(var t=e(this),i=t.data("syotimer-options"),n=l.getTimerItem(),o=e("<div/>",{class:"syotimer__head"}).html(i.headTitle),r=e("<div/>",{class:"syotimer__body"}),a=e("<div/>",{class:"syotimer__footer"}).html(i.footTitle),s={},d=0;d<i.itemTypes.length;d++){var u=n.clone();u.addClass("syotimer-cell_type_"+i.itemTypes[d]),r.append(u),s[i.itemTypes[d]]=u}var m={headBlock:o,bodyBlock:r,footBlock:a};t.data("syotimer-blocks",m).data("syotimer-items",s).addClass("syotimer").append(o).append(r).append(a)},_perSecondHandler:function(){var t=e(this),i=t.data("syotimer-options");e(".syotimer-cell > .syotimer-cell__value",t).css("opacity",1);var n=new Date,o=new Date(i.year,i.month-1,i.day,i.hour,i.minute,i.second),r=l.getDifferenceWithTimezone(n,o,i),a=l.getSecondsToDeadLine(r,i);0<=a?(u._refreshUnitsDom.apply(this,[a]),u._applyEffectSwitch.apply(this,[i.effectType])):(t=e.extend(t,t.data("syotimer-blocks")),i.afterDeadline(t))},_refreshUnitsDom:function(i){var n=e(this),o=n.data("syotimer-options"),r=n.data("syotimer-items"),a=o.itemTypes,s=l.getUnitsToDeadLine(i);o._itemsHas.day||(s.hour+=24*s.day),o._itemsHas.hour||(s.minute+=60*s.hour),o._itemsHas.minute||(s.second+=60*s.minute);for(var d=0;d<a.length;d++){var u=a[d],m=s[u],c=r[u];c.data("syotimer-unit-value",m),e(".syotimer-cell__value",c).html(l.format2(m,u!==t&&o.doubleNumbers)),e(".syotimer-cell__unit",c).html(e.syotimerLang.getNumeral(m,o.lang,u))}},_applyEffectSwitch:function(t,i){i=i||o;var n,r,s,d=this,l=e(d);"none"===t?setTimeout((function(){u._perSecondHandler.apply(d,[])}),1e3):"opacity"!==t||(n=l.data("syotimer-items")[i])&&(r=a.next(i),s=n.data("syotimer-unit-value"),e(".syotimer-cell__value",n).animate({opacity:.1},1e3,"linear",(function(){u._perSecondHandler.apply(d,[])})),r&&0===s&&u._applyEffectSwitch.apply(d,[t,r]))}},l={getTimerItem:function(){var t=e("<div/>",{class:"syotimer-cell__value",text:"0"}),i=e("<div/>",{class:"syotimer-cell__unit"}),n=e("<div/>",{class:"syotimer-cell"});return n.append(t).append(i),n},getItemTypesByLayout:function(e){for(var t=[],i=0;i<e.length;i++)t.push(r[e[i]]);return t},getSecondsToDeadLine:function(e,t){var i,n,o,r,a=e/1e3;a=Math.floor(a);return t.periodic?(r=e/(1e3*(o=l.getPeriodUnit(t.periodUnit))),r=Math.ceil(r),r=Math.abs(r),0<=a?(n=0==(n=r%t.periodInterval)?t.periodInterval:n,--n):n=t.periodInterval-r%t.periodInterval,0==(i=a%o)&&a<0&&n--,Math.abs(n*o+i)):a},getUnitsToDeadLine:function(e){var i=t,n={};do{var o=l.getPeriodUnit(i);n[i]=Math.floor(e/o),e%=o}while(i=a.prev(i));return n},getPeriodUnit:function(e){switch(e){case"d":case t:return 86400;case"h":case i:return 3600;case"m":case n:return 60;case"s":case o:return 1}},getDifferenceWithTimezone:function(e,t,o){var r=t.getTime()-e.getTime(),a=0,s=0;return"local"!==o.timeZone&&(a=1e3*(parseFloat(o.timeZone)*l.getPeriodUnit(i)- -e.getTimezoneOffset()*l.getPeriodUnit(n))),o.ignoreTransferTime&&(s=1e3*(-e.getTimezoneOffset()*l.getPeriodUnit(n)- -t.getTimezoneOffset()*l.getPeriodUnit(n))),r-(a+s)},format2:function(e,t){return t=!1!==t,e<=9&&t?"0"+e:""+e}},m={setOption:function(t,i){var n=e(this),o=n.data("syotimer-options");o.hasOwnProperty(t)&&(o[t]=i,n.data("syotimer-options",o))}};e.fn.syotimer=function(t){if("string"==typeof t&&"setOption"===t){var i=Array.prototype.slice.call(arguments,1);return this.each((function(){m[t].apply(this,i)}))}if(null==t||"object"==typeof t)return u.init.apply(this,[t]);e.error("SyoTimer. Error in call methods: methods is not exist")},e.syotimerLang={rus:{second:["секунда","секунды","секунд"],minute:["минута","минуты","минут"],hour:["час","часа","часов"],day:["день","дня","дней"],handler:"rusNumeral"},eng:{second:["second","seconds"],minute:["minute","minutes"],hour:["hour","hours"],day:["day","days"]},por:{second:["segundo","segundos"],minute:["minuto","minutos"],hour:["hora","horas"],day:["dia","dias"]},spa:{second:["segundo","segundos"],minute:["minuto","minutos"],hour:["hora","horas"],day:["día","días"]},heb:{second:["שניה","שניות"],minute:["דקה","דקות"],hour:["שעה","שעות"],day:["יום","ימים"]},universal:function(e){return 1===e?0:1},rusNumeral:function(e){return 4<e%100&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]},getNumeral:function(t,i,n){var o=this[e.syotimerLang[i].handler||"universal"](t);return e.syotimerLang[i][n][o]}}}),window.jQuery);
